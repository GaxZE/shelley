import { Meta, Canvas, Story, ArgsTable, Source } from "@storybook/addon-docs";
import dedent from "ts-dedent";
import { Modal } from "../../indexLib";
import { StoryGrid } from "../StoryLayout";
import { ModalCustomTransition } from "./Modal.examples";

<Meta
  title="Overlays/Modal"
  argTypes={{
    inputPosition: {
      options: ["start", "end", "top", "bottom"],
      control: { type: "inline-radio" },
      defaultValue: "over",
    },
  }}
  component={Modal}
  decorators={[
    (Story) => (
      <StoryGrid minWidth="150px" gap="8px">
        <Story />
      </StoryGrid>
    ),
  ]}
/>

# Modal

<Source
  language="tsx"
  code={dedent`
    import { Modal } from "@actionishope/shelley";
  `}
/>

Modal provides the structure for a Modal including `backdrop` and `content` containers, transitions and focus locks required to keep a user focused inside active dialogs/areas without being able to 'wonder about' behind the backdrop etc.

For partial screen takeovers where you might be splitting the screen and you want things outside of the modal to remain accessible and part of the focus lock; provide `shards` (an array of refs) as part of `focusOnProps`. This will keep those areas inside of the focusable area.

## Content

Modal will take any child to render inside an internal `content` container which sits adjacent to `backdrop`.

Regular DOM attributes (`aria-LabelledBy` etc) set on Modal will be spread to the `content` container and are required to make accessible dialogs.

## Accessibility

This is a raw modal so it requires some additional stuff when used in the wild.

Dialog coomponent??? Trigger example?

{/_ MORE _/}

## Transitions

Modal provides some transitions out of the box to get you started. Set `transition` to either:

- `up`
- `zoom`

To add your own transition, set `transition` to `false` and add a `className` to the Modal.

<Source
  language="tsx"
  dark
  format={false}
  code={dedent`
import { classes as modalClasses } from "./modalExample.st.css";\n
  <Modal
    transition={false}
    className={modalClasses.myTransition}
  >
    <>Modal Contents</>
  </Modal>
  {/* sss */}
  `}
/>

Inside your own stylable stylesheet, `modalExample.st.css`

<Source
  language="css"
  dark
  format={false}
  code={dedent`
/* Import the root Modal class name (Modal), state classes the content container as well (content). */
@st-import Modal, [
  enter,
  enterActive,
  enterDone,
  exit, 
  exitActive,
  content] from "@actonishope/shelley/components/Modal/modal.st.css";\n
.myTransition {}\n
/* Backdrop */
Modal.myTransition.enter .backdrop {
  background-color: violet;
}
Modal.myTransition.enterActive .backdrop {
  background-color: yellow;
}
Modal.myTransition.enterDone .backdrop {
  background-color: blue;
}
Modal.myTransition.exit .backdrop {
  background-color: yellow;
}
Modal.myTransition.exitActive .backdrop {
  background-color: violet;
}\n
/* Content */
Modal.myTransition.enter .content {
  // Initial start state styles
}
Modal.myTransition.enterActive .content {
  // Transitioning to done state styles 
}
Modal.myTransition.enterDone .content {
  // Done
}
Modal.myTransition.exit .content {
  // Reverse direction - exit transiton start style
}
Modal.myTransition.exitActive .content {
  // Finishing state before removed from DOM.
}
  `}
/>

<Story
  name="Transtions"
  parameters={{
    docs: {
      source: {
        code: dedent`
  <Label inputControl={<input type="checkbox" />}>
    Clicking me will prove the association
  </Label>
`,
      },
    },
  }}
>
  {ModalCustomTransition.bind()}
</Story>

The imported state styles do not behave as stylable states because they are generated by CSS Transition Group. The imports resolve to the CSS transition group classes `enter-active` etc.

We cannot use the stylable pseudo syntax to target content (`Modal::content`) so we get around it by importing `content` directly from the Modal component stylable file in Shelley.

### CSS Transition group

Internally Modal uses [CSSTransition](http://reactcommunity.org/react-transition-group/css-transition) from [React Transition Group](http://reactcommunity.org/react-transition-group/)
which exposes transition stages for transition styling.

All the options are available via `transitionProps`.

```ts
  transitionProps={{
    // classNames: modalClasses.transition,
    timeout: 190,
    onEntering: () => {
      document.body.classList.add(modalClasses.blurBackground);
    },
    onExiting: () => {
      document.body.classList.remove(modalClasses.blurBackground);
    },
  }}
```

{/_ It is possible to add a via classNames inside transitionProps this way too. Expand on other options... _/}

## Focus on

Internally Modal uses [react-focus-on](https://github.com/theKashey/react-focus-on) which helps with WAI ARIA compliance for modals or any full-screen tasks:

- locks **focus** inside using [react-focus-lock](https://github.com/theKashey/react-focus-lock)
- disables page **scroll** and user interactions using [react-remove-scroll](https://github.com/theKashey/react-remove-scroll)
- hides rest of a page from screen-readers using [aria-hidden](https://github.com/theKashey/aria-hidden)

All the options are available via `focusOnProps`.

<Source
  language="tsx"
  code={dedent`
<Label htmlFor="myTextField">Label text</Label>
<input id="myTextField" type="text" placeholder="Focus people!"/>
  `}
/>

<Story
  name="inputControl"
  parameters={{
    docs: {
      source: {
        code: dedent`
  <Label inputControl={<input type="checkbox" />}>
    Clicking me will prove the association
  </Label>
`,
      },
    },
  }}
>
  {ModalCustomTransition.bind()}
</Story>

<Source language="tsx" id="internal-label--input-control" />

## Modal Props

<ArgsTable of={Modal} />

## Stying

<Source
  language="css"
  dark
  format={false}
  code={dedent`
    #docs {
      write-some: style-docs;
    }
  `}
/>
